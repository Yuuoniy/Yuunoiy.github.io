---
title: 计视 | A4边缘检测和硬币数量检查
date: 2018-10-22 08:31:10
tags:
---
霍夫变换
<!-- more -->


## 环境:
Windows 10, Cimg-2.4.0

## 步骤：
1. 将图片转为灰度图
2. 提取边缘
3. 做霍夫变换，将图像空间转化为霍夫空间，并且投票
参数空间中的亮点对应图像空间的一条直线。`
4. 对累加矩阵取最大值，获得边缘直线的斜率和截距
5. 两两直线求交点，并且使用投票机制
6. 票数最多的点为A4纸的四个顶点
7. 连接顶点形成边缘


**时间分析**
自己定筛选规则
分割
极坐标的形式，两种形式最好
怎么知道求出来的对不对。。
画图：检测直线对不对
基本原理要清楚。
抄下来改20%就好了。。(意思是可以抄??) 好像是，自己写当然难啦

### 计算A4纸边缘的直线方程
程序运行求边缘图会有很多噪点
通过提高 low 和 high 的值是的
并且移除比较短的边缘。这里我设的值为 180 
#### 提取边缘
canny
#### 变换空间
检测直线的霍夫变换使用含极坐标参数的直线表示型式简称极坐标式

过程：
1. 根据需求修改上周代码，生成边缘图
2. 霍夫变换，转化为霍夫空间

坐标原点 在 width/2,height/2 处

画直线：
Cimg:

### 硬币
检测硬币的个数：霍夫变换
霍夫圆变换 
霍夫算法检测圆原理:
圆上任意一点的坐标可以表示为一下形式，所以对于任意一个圆，假设圆心是$x_0,y_0$ ，圆半径为 r，由极坐标方程可以得到圆上每个点的坐标，相反，如果知道圆上像素点，圆半径，旋转360度则中心点处的坐标值必定最强。

$x = x_0+rcos\theta$  
$y = y_0+rcos\theta$

算法：
1. 对每个像素点转化到极坐标对应圆的中心极坐标强度累计
2. 在极坐标空间中，对强度值归一化，让强度范围在0~255 之间
3. 寻找强度最大的点，一般为圆心的中心点

删除重复的圆:
通过计算圆心距，判断两个圆的位置关系，如果两个圆是包含关系，则取圆心投票值最大的那个圆。

遇到的问题： 

但是很难定位到。。

越界访问，而且gdb 的报错没有提示关键的信息，通常是提示一些库函数中的异常，运行很多次才会发现 gdb 在某一行崩溃了。非常的迷
### 程序实现
边缘检测沿用上周代码 canny,做了少量修改，将要删除边缘的长度作为参数传入。
houghLine.cpp 检测A4纸边缘的类
包括的属性和方法：

houghCircle.cpp 检测硬币边缘的类
main.cpp 为测试代码

### 程序测试
#### 测试环境
CImg-2.4.0 ,windows 10 
#### 测试数据
#### 测试结果
#### 结果分析
时间分析:

参考资料：
1. https://blog.csdn.net/sinat_31790817/article/details/80141945?utm_source=blogxgwz1
2. https://www.cnblogs.com/cheermyang/p/5348820.html
3. https://github.com/fatetail/CImg/blob/master/A4/A4/Hough.cpp
4. https://framagit.org/dtschump/CImg/tree/master
